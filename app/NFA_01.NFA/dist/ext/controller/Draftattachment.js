sap.ui.define(["sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/UIComponent"],function(e,t,r){"use strict";function o(r,o){var n;let a;function s(e){n&&n.getBeginButton().setEnabled(e)}function i(e){n.setBusy(e)}function l(){n&&n.close()}function c(t,r,o){e.error("Upload failed",{title:"Error"})}function u(e){return sap.ui.core.Fragment.byId("excelUploadDialog",e)}return{onBeforeOpen:function(e){n=e.getSource();r.addDependent(n)},onAfterClose:function(e){r.removeDependent(n);n.destroy();n=undefined},_getBaseURL:function(){debugger;var e=this.getOwnerComponent().getManifestEntry("/sap.app/id").replaceAll(".","/");return jQuery.sap.getModulePath(e)},onFileChange:function(e){var t=e.getParameters("files").files[0];this.file=t},onOk:function(e){debugger;let t=e.oSource.oPropagatedProperties.oModels.pageInternal.mContexts["/pages/NFA01.NFA::Source_EventsObjectPage/controls/fe::table::questionaire::LineItem::Questions"].oModel.oData.deepestPath;const r=/\/Source_Events\('([^']+)'\)/;const o=t.match(r);const n=o[1];a=e.oSource.oParent.oParent.byId("fe::ObjectPage-OPHeaderContent").getContent()[0].mAggregations.items[0].mAggregations.items[0].mAggregations.items[1].mAggregations.items[1].mProperties.text;var s=u("__fileUploader");var i=new FileReader;i.onload=function(e){debugger;var t=this.file;this.content=e.currentTarget.result;this.createfile(n)}.bind(this);i.readAsDataURL(this.file)},createfile:function(t){debugger;var r=this;var t=t;var o=this.file;var n=this.content;var s=n.split(",")[1];var i=this.file.name;var c=this.file.type;const u=atob(s);const g=new ArrayBuffer(u.length);const f=new Uint8Array(g);for(let e=0;e<u.length;e++){f[e]=u.charCodeAt(e)}const d=new Blob([g],{type:c});const p=new File([d],i,{type:c});debugger;var m="https://nfa_app-grateful-duiker-kc.cfapps.us20.hana.ondemand.com/dev/postDocument";var h=new FormData;var v=o;var b=c;var y=i;var F=t;debugger;var P={base64Content:s.toString(),filename:i,Srcevtname:a};console.log(s);debugger;fetch(m,{method:"POST",body:JSON.stringify(P)}).then(function(t){debugger;if(t.status===200){debugger;var r="File Uploaded Successfully";e.success(r);l();console.log("Success: "+response.body)}else{debugger;var r="Failed to upload";e.error("Failed to upload");l();console.log("Error: "+response.body)}}).catch(function(e){debugger;console.error(e)});debugger},onCancel:function(e){l()},onTypeMismatch:function(e){var t=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");c("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+t)},onFileAllowed:function(e){s(true)},onFileEmpty:function(e){s(false)},onUploadComplete:function(e){var o=e.getParameter("status");var n=e.getSource();n.clear();s(false);i(false);if(o>=400){var a;try{a=JSON.parse(e.getParameter("responseRaw"))}catch(t){a=e.getParameter("responseRaw")}if(a&&a.error&&a.error.message){c(a.error.code,a.error.target,a&&a.error&&a.error.message)}}else{t.show("File uploaded successfully");r.refresh();l()}}}}return{upload:function(e,t){debugger;this.loadFragment({id:"excelUploadDialog",name:"NFA01.NFA.ext.fragment.Draftattachment",controller:o(this,"MediaFile")}).then(function(e){e.open()})}}});
//# sourceMappingURL=Draftattachment.js.map